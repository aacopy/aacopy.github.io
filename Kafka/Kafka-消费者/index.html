<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Kafka-æ¶ˆè´¹è€… | aacopy</title><meta name="keywords" content="Kafka,æ¶ˆæ¯é˜Ÿåˆ—"><meta name="author" content="cmyang"><meta name="copyright" content="cmyang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Kafka-æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„ç­–ç•¥">
<meta property="og:type" content="article">
<meta property="og:title" content="Kafka-æ¶ˆè´¹è€…">
<meta property="og:url" content="https://www.aacopy.cn/Kafka/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/index.html">
<meta property="og:site_name" content="aacopy">
<meta property="og:description" content="Kafka-æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„ç­–ç•¥">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.aacopy.cn/images/common/kafka.png">
<meta property="article:published_time" content="2021-12-22T15:37:00.000Z">
<meta property="article:modified_time" content="2022-06-06T13:16:56.168Z">
<meta property="article:author" content="cmyang">
<meta property="article:tag" content="Kafka">
<meta property="article:tag" content="æ¶ˆæ¯é˜Ÿåˆ—">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.aacopy.cn/images/common/kafka.png"><link rel="shortcut icon" href="/images/common/favicon.png"><link rel="canonical" href="https://www.aacopy.cn/Kafka/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Kafka-æ¶ˆè´¹è€…',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-06-06 21:16:56'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/common/header.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">107</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">46</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">29</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">aacopy</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Kafka-æ¶ˆè´¹è€…</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-12-22T15:37:00.000Z" title="å‘è¡¨äº 2021-12-22 23:37:00">2021-12-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-06-06T13:16:56.168Z" title="æ›´æ–°äº 2022-06-06 21:16:56">2022-06-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Kafka/">Kafka</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Kafka-æ¶ˆè´¹è€…"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="è·å–æ¶ˆæ¯ç­–ç•¥"><a href="#è·å–æ¶ˆæ¯ç­–ç•¥" class="headerlink" title="è·å–æ¶ˆæ¯ç­–ç•¥"></a>è·å–æ¶ˆæ¯ç­–ç•¥</h2><p>æ‹‰å–ï¼ˆpullï¼‰çš„æ–¹å¼ï¼Œæ¶ˆè´¹è€…ä»partitionä¸­ä¸»åŠ¨æ‹‰å–æ¶ˆæ¯ã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®æ€§èƒ½å¤„ç†æ¶ˆæ¯ï¼Œå¦‚æœæ˜¯pushæ¨¡å¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å¹¶å‘ä¸å¤Ÿå¤„ç†ä¸è¿‡æ¥ï¼ŒMQçš„å‰Šå³°ä¹Ÿå°±æ²¡æœ‰äº†æ„ä¹‰</li>
<li>å¦‚æœæœåŠ¡ç«¯æ²¡æœ‰æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯ä¼šå®šæ—¶å‘é€è¯·æ±‚ï¼Œæ ¹æ®è¶…æ—¶æ—¶é—´ï¼Œé˜»å¡ä¸€æ®µæ—¶é—´åå†è¿”å›</li>
</ul>
<h2 id="åˆ†åŒºåˆ†é…ç­–ç•¥"><a href="#åˆ†åŒºåˆ†é…ç­–ç•¥" class="headerlink" title="åˆ†åŒºåˆ†é…ç­–ç•¥"></a>åˆ†åŒºåˆ†é…ç­–ç•¥</h2><p>é€šè¿‡partition.assignment.strategyé…ç½®ï¼ŒConsumerConfig.PARTITION_ASSIGNMENT_STRATEGY_CONFIGè·å–</p>
<p>é»˜è®¤ç­–ç•¥ï¼šRangeAssignorï¼ˆæŒ‰ç…§ä¸»é¢˜è¿›è¡ŒèŒƒå›´åˆ†é…ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.define(PARTITION_ASSIGNMENT_STRATEGY_CONFIG,</span><br><span class="line">            Type.LIST,</span><br><span class="line">            Arrays.asList(RangeAssignor.class, CooperativeStickyAssignor.class),<span class="comment">//é»˜è®¤å€¼</span></span><br><span class="line">            <span class="keyword">new</span> ConfigDef.NonNullValidator(),</span><br><span class="line">            Importance.MEDIUM,</span><br><span class="line">            PARTITION_ASSIGNMENT_STRATEGY_DOC)</span><br></pre></td></tr></table></figure>

<p>kafkaçš„åˆ†é…ç­–ç•¥</p>
<ul>
<li><p>RangeAssignor</p>
<p>æŒ‰ç…§ä¸»é¢˜è¿›è¡ŒèŒƒå›´åˆ†é…</p>
</li>
<li><p>RoundRobinAssignor</p>
<p>è½®è¯¢åˆ†é…ï¼Œä»¥å¾ªç¯æ–¹å¼å°†åˆ†åŒºåˆ†é…ç»™æ¶ˆè´¹è€…</p>
</li>
<li><p>StickyAssignor</p>
<p>ä¿è¯åˆ†é…æ˜¯æœ€å¤§é™åº¦çš„å¹³è¡¡ï¼ŒåŒæ—¶ä¿ç•™å°½å¯èƒ½å¤šçš„ç°æœ‰åˆ†åŒºåˆ†é…ã€‚</p>
</li>
<li><p>CooperativeStickyAssignor</p>
<p>éµå¾ªStickyAssignorç›¸åŒçš„é€»è¾‘ï¼Œä½†å…è®¸åˆä½œå†å¹³è¡¡ã€‚</p>
</li>
</ul>
<p>é»˜è®¤çš„assignoræ˜¯[RangeAssignor, CooperativeStickyAssignor]ï¼Œé»˜è®¤ä½¿ç”¨RangeAssignorï¼Œä½†æ˜¯å…è®¸å‡çº§åˆ°CooperativeStickyAssignorï¼Œåªéœ€ä»åˆ—è¡¨ä¸­ç§»é™¤RangeAssignorã€‚</p>
<p>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç­–ç•¥ï¼Œé€šè¿‡å®ç°org.apache.kafka.clients.consumer.ConsumerPartitionAssignor</p>
<h3 id="RoundRobinAssignor"><a href="#RoundRobinAssignor" class="headerlink" title="RoundRobinAssignor"></a>RoundRobinAssignor</h3><p>å®ç°æ–¹å¼ï¼šè·å–ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­è®¢é˜…çš„æ‰€æœ‰çš„Topicä¸­çš„æ‰€æœ‰partitionï¼Œå’Œæ¶ˆè´¹è€…ç»„ä¸­æ‰€æœ‰çš„æ¶ˆè´¹è€…åˆ—è¡¨ï¼Œå¤–å±‚éå†partitionåˆ—è¡¨ï¼Œå†…å­˜éå†æ¶ˆè´¹è€…åˆ—è¡¨ï¼Œå°†æ¯ä¸ªpartitionä¾æ¬¡åˆ†é…ç»™æ¶ˆè´¹è€…ã€‚</p>
<p>ç¤ºä¾‹1ï¼š</p>
<p><img src="/images/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/image-20211230112141081.png" alt="image-20211230112141081"></p>
<p>ç¤ºä¾‹2ï¼š</p>
<p>å®˜æ–¹ç¤ºä¾‹ï¼š</p>
<blockquote>
<p>When subscriptions differ across consumer instances, the assignment process still considers each consumer instance in round robin fashion but skips over an instance if it is not subscribed to the topic. Unlike the case when subscriptions are identical, this can result in imbalanced assignments. For example, we have three consumers C0, C1, C2, and three topics t0, t1, t2, with 1, 2, and 3 partitions, respectively. Therefore, the partitions are t0p0, t1p0, t1p1, t2p0, t2p1, t2p2. C0 is subscribed to t0; C1 is subscribed to t0, t1; and C2 is subscribed to t0, t1, t2.<br>That assignment will be:<br>C0: [t0p0]<br>C1: [t1p0]<br>C2: [t1p1, t2p0, t2p1, t2p2]</p>
</blockquote>
<p>æˆ‘ä»¬æœ‰ä¸‰ä¸ªæ¶ˆè´¹è€…C0ã€C1ã€C2å’Œä¸‰ä¸ªä¸»é¢˜t0ã€t1ã€t2ï¼Œåˆ†åˆ«æœ‰1ã€2å’Œ3ä¸ªåˆ†åŒºã€‚å› æ­¤ï¼Œåˆ†åŒºä¸ºt0p0, t1p0, t1p1, t2p0, t2p1, t2p2ã€‚C0è®¢é˜…åˆ°t0;C1è®¢é˜…t0, t1;C2è®¢é˜…äº†t0 t1 t2ã€‚</p>
<p><img src="/images/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/image-20211230112332363.png" alt="image-20211230112332363"></p>
<p>å¦‚æœåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ä¸åŒçš„æ¶ˆè´¹è€…è®¢é˜…äº†ä¸åŒçš„ä¸»é¢˜ï¼Œå°±ä¼šä¸å‡åŒ€åˆ†é…ï¼Œä¸Šé¢çš„T1P1å®Œå…¨å¯ä»¥åˆ†é…ç»™æ¶ˆè´¹è€…2</p>
<p>æºç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoundRobinAssignor</span> <span class="keyword">extends</span> <span class="title">AbstractPartitionAssignor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, List&lt;TopicPartition&gt;&gt; assign(Map&lt;String, Integer&gt; partitionsPerTopic,</span><br><span class="line">                                                    Map&lt;String, Subscription&gt; subscriptions) &#123;</span><br><span class="line">        Map&lt;String, List&lt;TopicPartition&gt;&gt; assignment = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//è·å–æ¶ˆè´¹è€…ç»„ä¸­æ‰€æœ‰çš„æ¶ˆè´¹è€…</span></span><br><span class="line">        List&lt;MemberInfo&gt; memberInfoList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Subscription&gt; memberSubscription : subscriptions.entrySet()) &#123;</span><br><span class="line">            assignment.put(memberSubscription.getKey(), <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">            memberInfoList.add(<span class="keyword">new</span> MemberInfo(memberSubscription.getKey(),</span><br><span class="line">                                              memberSubscription.getValue().groupInstanceId()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CircularIterator&lt;MemberInfo&gt; assigner = <span class="keyword">new</span> CircularIterator&lt;&gt;(Utils.sorted(memberInfoList));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (TopicPartition partition : allPartitionsSorted(partitionsPerTopic, subscriptions)) &#123;</span><br><span class="line">            <span class="keyword">final</span> String topic = partition.topic();</span><br><span class="line">            <span class="comment">//åˆ¤æ–­å½“å‰éå†çš„partitionæ‰€å±çš„ä¸»é¢˜åœ¨å½“å‰æ¶ˆè´¹è€…æ˜¯å¦è®¢é˜…ï¼Œå¦‚æœæ²¡æœ‰è®¢é˜…ç»§ç»­è·å–ä¸‹ä¸€ä¸ªæ¶ˆè´¹è€…</span></span><br><span class="line">            <span class="keyword">while</span> (!subscriptions.get(assigner.peek().memberId).topics().contains(topic))</span><br><span class="line">                assigner.next();</span><br><span class="line">            assignment.get(assigner.next().memberId).add(partition);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> assignment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–æ¶ˆè´¹è€…ç»„å†…è®¢é˜…çš„topicä¸­æ‰€æœ‰çš„patitioné›†åˆ</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;TopicPartition&gt; <span class="title">allPartitionsSorted</span><span class="params">(Map&lt;String, Integer&gt; partitionsPerTopic,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                     Map&lt;String, Subscription&gt; subscriptions)</span> </span>&#123;</span><br><span class="line">        SortedSet&lt;String&gt; topics = <span class="keyword">new</span> TreeSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Subscription subscription : subscriptions.values())</span><br><span class="line">            topics.addAll(subscription.topics());</span><br><span class="line"></span><br><span class="line">        List&lt;TopicPartition&gt; allPartitions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String topic : topics) &#123;</span><br><span class="line">            Integer numPartitionsForTopic = partitionsPerTopic.get(topic);</span><br><span class="line">            <span class="keyword">if</span> (numPartitionsForTopic != <span class="keyword">null</span>)</span><br><span class="line">                allPartitions.addAll(AbstractPartitionAssignor.partitions(topic, numPartitionsForTopic));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> allPartitions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;roundrobin&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RangeAssignor"><a href="#RangeAssignor" class="headerlink" title="RangeAssignor"></a>RangeAssignor</h3><p>å®ç°æ–¹å¼ï¼šè·å–æ¶ˆè´¹è€…ç»„ä¸­çš„æ‰€æœ‰ä¸»é¢˜ï¼Œéå†ä¸»é¢˜ï¼Œè·å–æ¯ä¸ªä¸»é¢˜ä¸‹é¢çš„æ‰€æœ‰æ¶ˆè´¹è€…çš„æ•°é‡å’Œåˆ†åŒºæ•°é‡ï¼Œç”¨åˆ†åŒºæ•°é‡é™¤ä»¥æ¶ˆè´¹è€…æ•°é‡ï¼Œè·å–æ¯ä¸ªæ¶ˆè´¹è€…åº”è¯¥åˆ†é…åˆ°çš„åˆ†åŒºæ•°ï¼Œå¦‚æœæœ‰ä½™æ•°ï¼ŒæŒ‰ç…§é¡ºåºï¼Œæ’åœ¨å‰é¢çš„æ¶ˆè´¹è€…æ¯ä¸ªå¤šåˆ†é…ä¸€ä¸ªåˆ†åŒºã€‚</p>
<p>ç¤ºä¾‹1ï¼š</p>
<p><img src="/images/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/image-20211230114834382.png" alt="image-20211230114834382"></p>
<p>å®˜æ–¹ç¤ºä¾‹2ï¼š</p>
<blockquote>
<p>For example, suppose there are two consumers C0 and C1, two topics t0 and t1, and each topic has 3 partitions, resulting in partitions t0p0, t0p1, t0p2, t1p0, t1p1, and t1p2.<br>The assignment will be:<br>C0: [t0p0, t0p1, t1p0, t1p1]<br>C1: [t0p2, t1p2]</p>
</blockquote>
<p>å‡è®¾æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…C0å’ŒC1ï¼Œä¸¤ä¸ªä¸»é¢˜t0å’Œt1ï¼Œæ¯ä¸ªä¸»é¢˜æœ‰3ä¸ªåˆ†åŒºï¼Œå¯¼è‡´åˆ†åŒºt0p0ã€t0p1ã€t0p2ã€t1p0ã€t1p1å’Œt1p2ã€‚</p>
<p><img src="/images/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/image-20211230132133763.png" alt="image-20211230132133763"></p>
<p>å¦‚æœæœ‰å¾ˆå¤štopicï¼Œè¿™ç§æ–¹æ¡ˆä¼šå¯¼è‡´æ’åœ¨å‰é¢çš„æ¶ˆè´¹è€…å‹åŠ›æ¯”åé¢çš„å¤§</p>
<p>æºç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RangeAssignor</span> <span class="keyword">extends</span> <span class="title">AbstractPartitionAssignor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;range&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;MemberInfo&gt;&gt; consumersPerTopic(Map&lt;String, Subscription&gt; consumerMetadata) &#123;</span><br><span class="line">        Map&lt;String, List&lt;MemberInfo&gt;&gt; topicToConsumers = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Subscription&gt; subscriptionEntry : consumerMetadata.entrySet()) &#123;</span><br><span class="line">            String consumerId = subscriptionEntry.getKey();</span><br><span class="line">            MemberInfo memberInfo = <span class="keyword">new</span> MemberInfo(consumerId, subscriptionEntry.getValue().groupInstanceId());</span><br><span class="line">            <span class="keyword">for</span> (String topic : subscriptionEntry.getValue().topics()) &#123;</span><br><span class="line">                put(topicToConsumers, topic, memberInfo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> topicToConsumers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, List&lt;TopicPartition&gt;&gt; assign(Map&lt;String, Integer&gt; partitionsPerTopic,</span><br><span class="line">                                                    Map&lt;String, Subscription&gt; subscriptions) &#123;</span><br><span class="line">        Map&lt;String, List&lt;MemberInfo&gt;&gt; consumersPerTopic = consumersPerTopic(subscriptions);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, List&lt;TopicPartition&gt;&gt; assignment = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String memberId : subscriptions.keySet())</span><br><span class="line">            assignment.put(memberId, <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">		<span class="comment">//éå†æ‰€æœ‰çš„topic</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;MemberInfo&gt;&gt; topicEntry : consumersPerTopic.entrySet()) &#123;</span><br><span class="line">            String topic = topicEntry.getKey();</span><br><span class="line">            <span class="comment">//è·å–topicçš„è®¢é˜…è€…</span></span><br><span class="line">            List&lt;MemberInfo&gt; consumersForTopic = topicEntry.getValue();</span><br><span class="line">			<span class="comment">//è·å–topicçš„åˆ†åŒºæ•°é‡</span></span><br><span class="line">            Integer numPartitionsForTopic = partitionsPerTopic.get(topic);</span><br><span class="line">            <span class="keyword">if</span> (numPartitionsForTopic == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">			<span class="comment">//å¯¹æ¶ˆè´¹è€…è¿›è¡Œæ’åº</span></span><br><span class="line">            Collections.sort(consumersForTopic);</span><br><span class="line">			<span class="comment">//è®¡ç®—æ¯ä¸ªæ¶ˆè´¹è€…éœ€è¦åˆ†é…çš„åˆ†åŒºæ•°é‡</span></span><br><span class="line">            <span class="keyword">int</span> numPartitionsPerConsumer = numPartitionsForTopic / consumersForTopic.size();</span><br><span class="line">            <span class="comment">//è®¡ç®—æ²¡æ³•å¹³å‡åˆ†é…çš„åˆ†åŒºæ•°é‡</span></span><br><span class="line">            <span class="keyword">int</span> consumersWithExtraPartition = numPartitionsForTopic % consumersForTopic.size();</span><br><span class="line"></span><br><span class="line">            List&lt;TopicPartition&gt; partitions = AbstractPartitionAssignor.partitions(topic, numPartitionsForTopic);</span><br><span class="line">            <span class="comment">//éå†è®¢é˜…è¿‡çš„æ¯ä¸ªæ¶ˆè´¹è€…</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, n = consumersForTopic.size(); i &lt; n; i++) &#123;</span><br><span class="line">                <span class="comment">//è®¡ç®—æ¯ä¸ªæ¶ˆè´¹è€…åˆ†é…çš„åˆ†åŒºçš„å¼€å§‹index</span></span><br><span class="line">                <span class="keyword">int</span> start = numPartitionsPerConsumer * i + Math.min(i, consumersWithExtraPartition);</span><br><span class="line">                <span class="comment">//è®¡ç®—æ¯ä¸ªæ¶ˆè´¹è€…æ˜¯å¦éœ€è¦é¢å¤–åˆ†é…ä¸€ä¸ªåˆ†åŒº</span></span><br><span class="line">                <span class="keyword">int</span> length = numPartitionsPerConsumer + (i + <span class="number">1</span> &gt; consumersWithExtraPartition ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">                assignment.get(consumersForTopic.get(i).memberId).addAll(partitions.subList(start, start + length));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> assignment;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="StickyAssignor"><a href="#StickyAssignor" class="headerlink" title="StickyAssignor"></a>StickyAssignor</h3><p>ç²˜æ€§åˆ†é…å™¨æœ‰ä¸¤ä¸ªç›®çš„</p>
<ol>
<li>ä¿è¯å°½å¯èƒ½å¹³è¡¡çš„åˆ†é…</li>
<li>å½“é‡æ–°åˆ†é…å‘ç”Ÿæ—¶ï¼Œå®ƒå°½å¯èƒ½å¤šåœ°ä¿ç•™äº†ç°æœ‰çš„åˆ†é…ã€‚è¿™æœ‰åŠ©äºåœ¨ä¸»é¢˜åˆ†åŒºä»ä¸€ä¸ªæ¶ˆè´¹è€…è½¬ç§»åˆ°å¦ä¸€ä¸ªæ¶ˆè´¹è€…æ—¶èŠ‚çœä¸€äº›å¼€é”€å¤„ç†ã€‚</li>
</ol>
<h4 id="ç¤ºä¾‹1ï¼š"><a href="#ç¤ºä¾‹1ï¼š" class="headerlink" title="ç¤ºä¾‹1ï¼š"></a>ç¤ºä¾‹1ï¼š</h4><p>å‡è®¾æœ‰ä¸‰ä¸ªæ¶ˆè´¹è€…C0ã€C1ã€C2ï¼Œå››ä¸ªä¸»é¢˜t0ã€t1ã€t2ã€t3ï¼Œæ¯ä¸ªä¸»é¢˜æœ‰2ä¸ªåˆ†åŒºï¼Œå½¢æˆåˆ†åŒºt0p0ã€t0p1ã€t1p0ã€t1p1ã€t2p0ã€t2p1ã€t3p0ã€t3p1ã€‚æ¯ä¸ªæ¶ˆè´¹è€…éƒ½è®¢é˜…äº†æ‰€æœ‰ä¸‰ä¸ªä¸»é¢˜ã€‚</p>
<p>ç²˜æ€§åˆ†é…å™¨å’Œè½®è¯¢åˆ†é…å™¨çš„åˆ†é…ç»“æœç›¸åŒï¼š</p>
<p>C0: [t0p0, t1p1, t3p0]<br>C1: [t0p1, t2p0, t3p1]<br>C2: [t1p0, t2p1]</p>
<p><img src="/images/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/image-20220101165705649.png" alt="image-20220101165705649"></p>
<p>å‡è®¾C1è¢«åˆ é™¤ï¼Œ</p>
<ul>
<li>è½®è¯¢ç­–ç•¥å°†ä¼šé‡æ–°åˆ†é…å¦‚ä¸‹ç»“æœï¼š</li>
</ul>
<p>C0: [t0p0, t1p0, t2p0, t3p0]<br>C2: [t0p1, t1p1, t2p1, t3p1]</p>
<p><img src="/images/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/image-20220101170347490.png" alt="image-20220101170347490"></p>
<ul>
<li>ç²˜æ€§åˆ†é…å™¨ç­–ç•¥å°†ä¼šé‡æ–°åˆ†é…å¦‚ä¸‹ç»“æœï¼š</li>
</ul>
<p>C0 [t0p0, t1p1, t3p0, t2p0]<br>C2 [t1p0, t2p1, t0p1, t3p1]</p>
<p><img src="/images/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/image-20220101170400295.png" alt="image-20220101170400295"></p>
<p><strong>å¯ä»¥çœ‹å‡ºç²˜æ€§åˆ†é…å™¨ç­–ç•¥ä¿ç•™æ‰€æœ‰ä»¥å‰çš„åˆ†é…</strong></p>
<h4 id="ç¤ºä¾‹2"><a href="#ç¤ºä¾‹2" class="headerlink" title="ç¤ºä¾‹2"></a>ç¤ºä¾‹2</h4><p>æœ‰ä¸‰ä¸ªæ¶ˆè´¹è€…C0ã€C1ã€C2ï¼Œä»¥åŠä¸‰ä¸ªä¸»é¢˜t0ã€t1ã€t2ï¼Œåˆ†åˆ«æœ‰1ã€2ã€3ä¸ªåˆ†åŒºã€‚å› æ­¤ï¼Œåˆ†åŒºä¸ºt0p0, t1p0, t1p1, t2p0, t2p1, t2p2ã€‚C0è¢«è®¢é˜…ä¸ºt0ï¼›C1è¢«è®¢é˜…ä¸ºt0ã€t1ï¼›C2è¢«è®¢é˜…ä¸ºt0ã€t1ã€t2ã€‚</p>
<ul>
<li>è½®è¯¢ç­–ç•¥åˆ†é…ç»“æœï¼š</li>
</ul>
<p>C0 [t0p0]<br>C1 [t1p0]<br>C2 [t1p1, t2p0, t2p1, t2p2]</p>
<p><img src="/images/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/image-20220101171354358.png" alt="image-20220101171354358"></p>
<ul>
<li>ç²˜æ€§ç­–ç•¥åˆ†é…ç»“æœï¼š</li>
</ul>
<p>C0 [t0p0]<br>C1 [t1p0, t1p1]<br>C2 [t2p0, t2p1, t2p2]</p>
<p><img src="/images/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/image-20220101171446089.png" alt="image-20220101171446089"></p>
<p>å¦‚æœåˆ é™¤C0æ¶ˆè´¹è€…</p>
<p>Round Robiné‡æ–°åˆ†é…ç»“æœå¦‚ä¸‹ï¼š</p>
<p>C1 [t0p0, t1p1]<br>C2 [t1p0, t2p0, t2p1, t2p2]</p>
<p>Stickyé‡æ–°åˆ†é…ç»“æœå¦‚ä¸‹ï¼š</p>
<p>C1 [t1p0, t1p1, t0p0]<br>C2 [t2p0, t2p1, t2p2]</p>
<h3 id="CooperativeStickyAssignor"><a href="#CooperativeStickyAssignor" class="headerlink" title="CooperativeStickyAssignor"></a>CooperativeStickyAssignor</h3><p>AbstractStickyAssignorçš„ä¸€ä¸ªåˆä½œç‰ˆæœ¬ã€‚å®ƒéµå¾ªä¸StickyAssignorç›¸åŒçš„ï¼ˆç²˜æ€§ï¼‰åˆ†é…é€»è¾‘ï¼Œä½†å…è®¸åˆä½œå¼å†å¹³è¡¡</p>
<p>Kafkaçš„ä¸¤ç§åè®®ï¼šEAGERï¼ŒCOOPERATIVE</p>
<ul>
<li><p>EAGERå†å¹³è¡¡åè®®è¦æ±‚æ¶ˆè´¹è€…åœ¨å‚ä¸å†å¹³è¡¡äº‹ä»¶ä¹‹å‰æ€»æ˜¯æ’¤é”€å…¶æ‰€æœ‰åˆ†åŒºã€‚å› æ­¤ï¼Œå®ƒå…è®¸å®Œå…¨é‡æ–°æ´—ç‰Œåˆ†é…ã€‚</p>
</li>
<li><p>COOPERATIVEé‡æ–°å¹³è¡¡åè®®å…è®¸æ¶ˆè´¹è€…åœ¨å‚ä¸é‡æ–°å¹³è¡¡äº‹ä»¶ä¹‹å‰ä¿ç•™å…¶å½“å‰æ‹¥æœ‰çš„åˆ†åŒºã€‚è€Œä¸æ˜¯ç«‹å³é‡æ–°åˆ†é…ä»»ä½•æ‹¥æœ‰çš„åˆ†åŒºï¼Œåˆ†é…è€…å¯ä»¥å‘æ¶ˆè´¹è€…è¡¨ç¤ºéœ€è¦æ’¤é”€è¯¥åˆ†åŒºï¼Œè¿™æ ·è¢«æ’¤é”€çš„åˆ†åŒºå°±å¯ä»¥åœ¨ä¸‹ä¸€æ¬¡é‡æ–°å¹³è¡¡äº‹ä»¶ä¸­é‡æ–°åˆ†é…ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚è¿™æ˜¯ä¸ºç²˜æ€§åˆ†é…é€»è¾‘è®¾è®¡çš„ï¼Œè¯¥é€»è¾‘è¯•å›¾é€šè¿‡åˆä½œè°ƒæ•´æ¥å°½é‡å‡å°‘åˆ†åŒºçš„é‡æ–°åˆ†é…ã€‚</p>
</li>
</ul>
<p>EAGERåè®®ï¼šRangeAssignorï¼ŒRoundRobinAssignorï¼ŒStickyAssignor</p>
<p>COOPERATIVEåè®®ï¼šCooperativeStickyAssignor</p>
<p>åœ¨é›†ç¾¤åºå¤§çš„æƒ…å†µä¸‹ï¼Œé¢‘ç¹çš„å‘ç”Ÿé›†ç¾¤èŠ‚ç‚¹ä¸Šä¸‹çº¿ï¼Œæ¶ˆè´¹è®¢é˜…å˜æ›´é¢‘ç¹ï¼ŒEAGERä¼šæ“ä½œå…¨éƒ¨çš„åˆ†åŒºï¼ŒCOOPERATIVEåªä¼šæ“ä½œéƒ¨åˆ†ï¼Œè¾¾åˆ°æœ€ç»ˆå¹³è¡¡</p>
<h2 id="æ¶ˆè´¹è®°å½•offset"><a href="#æ¶ˆè´¹è®°å½•offset" class="headerlink" title="æ¶ˆè´¹è®°å½•offset"></a>æ¶ˆè´¹è®°å½•offset</h2><ul>
<li><p>æ¶ˆè´¹è€…åˆ©ç”¨offsetè®°å½•æ¯ä¸ªæ¶ˆè´¹è€…ç»„æ¶ˆè´¹åˆ°å“ªä¸ªä½ç½®</p>
<ul>
<li><p>é€šè¿‡group.id+topic+patitin.idæ¥ç¡®å®šå”¯ä¸€çš„offsetçš„keyï¼Œvalueä¸ºoffsetçš„å€¼</p>
</li>
<li><p>kafkaé€šè¿‡å°†offsetå­˜æ”¾åœ¨ä¸€ä¸ªåç§°ä¸º__consumer_offsetsçš„å†…ç½®topicä¸­ã€‚é»˜è®¤æœ‰50ä¸ªpartition</p>
</li>
</ul>
</li>
<li><p>å¦‚ä½•ä»å¤´æ¶ˆè´¹partitionä¸­çš„æ•°æ®</p>
<ul>
<li>ä»å¤´å¼€å§‹æ¶ˆè´¹æ¶ˆæ¯ï¼Œéœ€è¦ä¸¤ç‚¹<ul>
<li>è®¾ç½®auto.offset.resetå±æ€§ä¸ºearliestï¼Œé»˜è®¤æ˜¯latest</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„æ¶ˆè´¹è€…ç»„</li>
</ul>
</li>
</ul>
</li>
<li><p>offsetæ‰‹åŠ¨æäº¤</p>
<ul>
<li><p>offseté»˜è®¤æ˜¯è‡ªåŠ¨æäº¤çš„ï¼Œåœ¨å®é™…å¾ˆå¤šåœºæ™¯ä¸­ï¼Œéœ€è¦ä¸šåŠ¡æœåŠ¡ç¡®å®šæ¶ˆæ¯æ˜¯å¦è¢«æ­£å¸¸æ¶ˆè´¹ï¼Œæ­£å¸¸æ¶ˆè´¹åæ‰å¯ä»¥æäº¤offset</p>
</li>
<li><p>è®¾ç½®enable.auto.commitå±æ€§ä¸ºfalse</p>
</li>
<li><p>æ‰‹åŠ¨æäº¤åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>åŒæ­¥é˜»å¡æäº¤ï¼škafkaConsumer.commitSync()</li>
<li>å¼‚æ­¥æäº¤ï¼škafkaConsumer.commitAsync()ï¼Œå®ç°onCompleteæ–¹æ³•å¤„ç†è‡ªå®šä¹‰é€»è¾‘</li>
</ul>
</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">cmyang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://www.aacopy.cn/Kafka/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/">https://www.aacopy.cn/Kafka/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://www.aacopy.cn" target="_blank">aacopy</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Kafka/">Kafka</a><a class="post-meta__tags" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">æ¶ˆæ¯é˜Ÿåˆ—</a></div><div class="post_share"><div class="social-share" data-image="/images/common/kafka.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Kafka/Kafka-AdminApi/"><img class="prev-cover" src="/images/common/kafka.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Kafka-AdminApi</div></div></a></div><div class="next-post pull-right"><a href="/Kafka/Kafka-%E7%94%9F%E4%BA%A7%E8%80%85/"><img class="next-cover" src="/images/common/kafka.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Kafka-ç”Ÿäº§è€…</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/Kafka/Kafka-AdminApi/" title="Kafka-AdminApi"><img class="cover" src="/images/common/kafka.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-27</div><div class="title">Kafka-AdminApi</div></div></a></div><div><a href="/Kafka/Kafka-HelloWorld/" title="Kafka-HelloWorld"><img class="cover" src="/images/common/kafka.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-06</div><div class="title">Kafka-HelloWorld</div></div></a></div><div><a href="/Kafka/Kafka-SpringBoot/" title="Kafka-SpringBoot"><img class="cover" src="/images/common/kafka.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-07</div><div class="title">Kafka-SpringBoot</div></div></a></div><div><a href="/Kafka/Kafka-äº‹åŠ¡æ¶ˆæ¯/" title="Kafka-äº‹åŠ¡æ¶ˆæ¯"><img class="cover" src="/images/common/kafka.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-04</div><div class="title">Kafka-äº‹åŠ¡æ¶ˆæ¯</div></div></a></div><div><a href="/Kafka/Kafka-å‘½ä»¤/" title="Kafka-å‘½ä»¤"><img class="cover" src="/images/common/kafka.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-14</div><div class="title">Kafka-å‘½ä»¤</div></div></a></div><div><a href="/Kafka/Kafka-æ–‡ä»¶å­˜å‚¨æœºåˆ¶/" title="Kafka-æ–‡ä»¶å­˜å‚¨æœºåˆ¶"><img class="cover" src="/images/common/kafka.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-13</div><div class="title">Kafka-æ–‡ä»¶å­˜å‚¨æœºåˆ¶</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B6%88%E6%81%AF%E7%AD%96%E7%95%A5"><span class="toc-number">1.</span> <span class="toc-text">è·å–æ¶ˆæ¯ç­–ç•¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5"><span class="toc-number">2.</span> <span class="toc-text">åˆ†åŒºåˆ†é…ç­–ç•¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RoundRobinAssignor"><span class="toc-number">2.1.</span> <span class="toc-text">RoundRobinAssignor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RangeAssignor"><span class="toc-number">2.2.</span> <span class="toc-text">RangeAssignor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#StickyAssignor"><span class="toc-number">2.3.</span> <span class="toc-text">StickyAssignor</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1%EF%BC%9A"><span class="toc-number">2.3.1.</span> <span class="toc-text">ç¤ºä¾‹1ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2"><span class="toc-number">2.3.2.</span> <span class="toc-text">ç¤ºä¾‹2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CooperativeStickyAssignor"><span class="toc-number">2.4.</span> <span class="toc-text">CooperativeStickyAssignor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%AE%B0%E5%BD%95offset"><span class="toc-number">3.</span> <span class="toc-text">æ¶ˆè´¹è®°å½•offset</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By cmyang</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="http://beian.miit.gov.cn/" target="_blank">çš–ICPå¤‡2022008292å·</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='all'|| 'all' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://www.aacopy.cn/categories/Kafka/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ’¡ Kafka (11)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.aacopy.cn/categories/Mysql/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“š Mysql (14)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.aacopy.cn/categories/SpringCloud/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ® SpringCloud (10)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.aacopy.cn/categories/ElasticSearch/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ±â€ğŸ‘“ ElasticSearch (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.aacopy.cn/categories/Flowable/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‘©â€ğŸ’» Flowable (8)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.aacopy.cn/categories/Redis/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“’ Redis (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://www.aacopy.cn/categories" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><!-- hexo injector body_end end --></body></html>